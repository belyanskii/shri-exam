<!DOCTYPE html>
<html>
<head>
    <title>Gallery</title>
    <link rel="stylesheet" href="css/style.css"/>
    <script type="text/javascript" src="js/jquery.js"></script>
</head>
<body class="b-page">
    <div class="b-slider__wrap">
        <ul class="b-slider"></ul>
    </div>
    <i class="b-nav b-nav-prev" onclick="prevImg()"></i>
    <i class="b-nav b-nav-next" onclick="nextImg()"></i>
    <div class="b-thumbs__bg">
        <div class="b-thumbs__wrap">
            <ul class="b-thumbs">
            </ul>
        </div>
    </div>
    <script type="text/javascript">
        var jsonData,
            imagesData,
            dWidth = $(document).width();

        function getData(){
            var apiUrl = 'http://api-fotki.yandex.ru/api/users/aig1001/album/63684/photos/created/?format=json&callback=?';
            $.getJSON(apiUrl, function(data) {
                jsonData = data;
                imagesData = jsonData.entries;
                takeFirstImage();
                imagesPreload(0, 20);
                $('.b-thumbs__item').first().addClass('b-thumbs__item-cur');
            });
        }

        var image = function(src, alt, cls){
            return $('<img />', {
                'alt':alt,
                'src': src,
                'class': cls
            });
        }

        function createThumb(i){
            var thumbImgLink = imagesData[i].img.XXS.href,
                    thumbImgTitle= imagesData[i].title,
                    bigImage = imagesData[i].img.L.href,
                    thumbsWrap = $('.b-thumbs'),
                    thumbsItem = $('<li class="b-thumbs__item"/>'),
                    thumbsItemPrev = $('.b-thumbs__item').last(),
                    thumbsImg = image(thumbImgLink, thumbImgTitle, 'b-thumbs__img');

            thumbsItem.append(thumbsImg).appendTo(thumbsWrap).data("curInfo", { number: i, curImgSrc: bigImage });
            if(thumbsItemPrev.length > 0){
                thumbsItemPrev.data("nextInfo", { nextImgSrc: bigImage });
            }
        }

        function imagesPreload(from, to){
            for (var i=from;i<to;i++)
            {
                if(imagesData[i]){
                    createThumb(i);
                }
            }
        }

        function takeFirstImage(){
            var firstImgLink = imagesData[0].img.L.href,
                    firstImgAlt = imagesData[1].title,
                    sliderItem = $('<li class="b-slider__item" />');

            $('<li class="b-slider__item" style="width:'+dWidth+'px;"><img class="b-slider__item-img" src="'+firstImgLink+'"/></li>').appendTo('.b-slider');
        }

        function nextImg(){
            var nextImgLink = $('.b-thumbs__item-cur').data('nextInfo').nextImgSrc;

            $('.b-thumbs__item-cur').removeClass('b-thumbs__item-cur').next().addClass('b-thumbs__item-cur');

            $('.b-slider').animate({left:"-="+dWidth+"px"}, 500, function() {
                    $('.b-slider').css('left', 0).children().first().remove();
            });

            $('<li class="b-slider__item" style="width:'+dWidth+'px;"><img class="b-slider__item-img" src="'+nextImgLink+'"/></li>').appendTo('.b-slider');
        }

        function prevImg(){
            if($('.b-thumbs__item-cur').index() != 0){
                var prevImage = $('.b-thumbs__item-cur').prev().data('curInfo').curImgSrc;
                $('.b-thumbs__item-cur').removeClass('b-thumbs__item-cur').prev().addClass('b-thumbs__item-cur');

                $('.b-slider').css('left', -dWidth).prepend('<li class="b-slider__item" style="width:'+dWidth+'px;"><img class="b-slider__item-img" src="'+prevImage+'"/></li>');

                $('.b-slider').animate({left:"+="+dWidth+"px"}, 500, function(){
                    $('.b-slider').css('left', 0).children().last().remove();
                });
            }
        }

        function takeImage(){

        }

        function centerCurImg(){
            dWidth = $(document).width();
            $('.b-slider__item').css('width', dWidth);
            if($('.b-slider').position().left < 0){
                $('.b-slider').css('left', -dWidth);
            }
        }

        $(window).load(function(){
            getData();
            centerCurImg();
        });

        $(window).resize(function(){
            centerCurImg();
        });
    </script>
</body>
</html>